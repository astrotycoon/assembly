/*
 * 检测点3.1
 *	问题: 在往地址0:0写入数据时，发现如果写过ds:[4]，则程序异常退出
 */
	.file	"test.S"
	.code16

// ax bx cx dx si di sp bp ip cs ds ss es

// .section .data
// data1:
// 	.byte 0x70, 0x80, 0xf0, 0x30, 0xef, 0x60, 0x30, 0xe2, 0x00, 0x80, 0x80, 0x12, 0x66, 0x20, 0x22, 0x60
// data2:
// 	.byte 0x62, 0x26, 0xe6, 0xd6, 0xcc, 0x2e, 0x3c, 0x3b, 0xab, 0xba, 0x00, 0x00, 0x26, 0x06, 0x66, 0x88
.section .text
.globl _start
_start:
	nop
	xorw %ax, %ax
	xorw %bx, %bx

	movw %cx, %ax
	movw %ax, %ss
	movw $stack, %sp

	movw $0x00, %ax
	movw %ax, %es
	
	leaw data, %si
	movw $0x00, %di
	movw $0, %bp
	movw $0x20, %cx
	call write_data

	/* return to DOS */
	/* INT 21h / AH=4Ch - return control to the operating system (stop program). */
	movw $0x4c00, %ax
	int $0x21

write_data:
	pushw %ax
.move:
	movb (%esi, %ebp, 1), %al
	movb %al, %es:(%edi, %ebp, 1)  	
	inc %bp
	loop .move
	popw %ax
	ret

data:
	.byte 0x70, 0x80, 0xf0, 0x30, 0xef, 0x60, 0x30, 0xe2, 0x00, 0x80, 0x80, 0x12, 0x66, 0x20, 0x22, 0x60
	.byte 0x62, 0x26, 0xe6, 0xd6, 0xcc, 0x2e, 0x3c, 0x3b, 0xab, 0xba, 0x00, 0x00, 0x26, 0x06, 0x66, 0x88

	.org 0x100
stack:		/* This is the bottom of the stack */
